SELECT * FROM (Select * from entries where entries.user_id=101 AND (entry_type='T' OR entry_type='D') AND 
date_trunc('day',entry_time)= date_trunc('day', (
SELECT MIN(entry_time)
FROM entries
WHERE date_trunc('day',entry_time)= '2012-12-31'
)
)
ORDER By entry_time) AS entrieslist
LEFT OUTER JOIN
(SELECT entry_id,array_agg(media_file_url) as pic_list from embeds,media_file where user_id=101 AND embeds.media_id=media_file.media_id GROUP BY entry_id) AS pics ON entrieslist.entry_id = pics.entry_id;


SELECT * FROM (Select entry_id,entry_type,text_content,title,to_char(entry_time,'MM.DD.YYYY HH12:MIAM') AS entry_time from entries where entries.user_id=101 AND (entry_type='T' OR entry_type='D') AND date_trunc('day',entry_time)= date_trunc('day', (SELECT MIN(entry_time) FROM entries WHERE date_trunc('day',entry_time)> 'yesterday')) ORDER By entry_time) AS entrieslist LEFT OUTER JOIN (SELECT entry_id,array_agg(media_file_url) as pic_list from embeds,media_file where user_id=101 AND embeds.media_id=media_file.media_id GROUP BY entry_id) AS pics ON entrieslist.entry_id = pics.entry_id;


SELECT entrieslist.*,pics.pic_list FROM (Select entry_id,entry_type,text_content,title,to_char(entry_time,'MM.DD.YYYY HH12:MIAM') AS entry_time from entries where entries.user_id=101 AND (entry_type='T' OR entry_type='D') AND date_trunc('day',entry_time)= date_trunc('day', (SELECT MIN(entry_time) FROM entries WHERE date_trunc('day',entry_time)> 'yesterday')) ORDER By entries.entry_time ASC) AS entrieslist LEFT OUTER JOIN (SELECT entry_id,array_agg(media_file_url) as pic_list from embeds,media_file where user_id=101 AND embeds.media_id=media_file.media_id GROUP BY entry_id) AS pics ON entrieslist.entry_id = pics.entry_id;


SELECT entrieslist.*,pics.pic_list FROM (Select entry_id,entry_type,text_content,title,to_char(entry_time,'MM.DD.YYYY HH12:MIAM') AS entry_time from entries where entries.user_id=101 AND (entry_type='M' OR entry_type='Y') AND date_trunc('year',entry_time)= date_trunc('year', (SELECT MAX(entry_time) FROM entries WHERE date_trunc('year',entry_time)< 'this month' AND (entry_type='M' OR entry_type='Y') AND user_id=101)) ORDER By entries.entry_time ASC) AS entrieslist LEFT OUTER JOIN (SELECT entry_id,array_agg(media_file_url) as pic_list from embeds,media_file where user_id=101 AND embeds.media_id=media_file.media_id GROUP BY entry_id) AS pics ON entrieslist.entry_id = pics.entry_id;


SELECT MAX(entry_time) FROM entries WHERE date_trunc('month',entry_time)< ('12.07.2013'-interval '1 month') AND (entry_type='M' OR entry_type='D') AND user_id=101;


SELECT entrieslist.*,pics.pic_list FROM (Select entry_id,entry_type,text_content,title,to_char(entry_time,'MM.DD.YYYY HH12:MIAM') AS entry_time from entries where entries.user_id=113 AND (entry_type='T' OR entry_type='D') AND date_trunc('day',entry_time)= date_trunc('day', (SELECT MIN(entry_time) FROM entries WHERE date_trunc('day',entry_time)> '12.06.2012' AND user_id=113 AND (entry_type='T' OR entry_type='D'))) ) AS entrieslist LEFT OUTER JOIN (SELECT entry_id,array_agg(media_file_url) as pic_list from embeds,media_file where user_id=113 AND embeds.media_id=media_file.media_id GROUP BY entry_id) AS pics ON entrieslist.entry_id = pics.entry_id ORDER By entrieslist.sort_time ASC;